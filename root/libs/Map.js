var Map;

Map = function(config) {
  this.g = null;
  this.zoom = true;
  this.text = false;
  this.transform = function(d) {
    return "translate(" + d.center.x + "," + d.center.y + ")";
  };
  this.colour = function(d) {
    return "#" + (d.colour_base.slice(0, 6));
  };
  this.opacity = function(d) {
    return 0.2;
  };
  this.stroke = function(d) {
    return "blue";
  };
  _.extend(this, config);
  this.drawPawns = function(data) {
    var actorData, actors, i, j, len, len1, m, ref, ref1, s;
    actorData = [];
    ref = data.squads;
    for (i = 0, len = ref.length; i < len; i++) {
      s = ref[i];
      ref1 = s.members;
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        m = ref1[j];
        m.squad = s;
        actorData.push(m);
      }
    }
    this.g.selectAll(".actors").remove();
    actors = this.g.append('g').attr('class', 'actors');
    actors = actors.selectAll(".actor").data(actorData).enter().append("g").attr("class", "actor").attr("transform", function(d) {
      return "translate( " + d.location.x + ", " + d.location.y + " )";
    });
    return actors.append("circle").attr("class", function(d) {
      if ((d.squad != null) && (d.squad.type != null)) {
        return d.squad.type.toLowerCase();
      } else {
        return "creature";
      }
    }).attr("r", "50.0").style("fill", function(d) {
      if (d.squad.health <= 0) {
        return "#DDDDDD";
      } else {
        return "";
      }
    }).style("stroke", function(d) {
      if (d.squad.health <= 0) {
        return "#CCCCCC";
      } else {
        return "";
      }
    });
  };
  this.drawOrders = function(data) {
    var from, i, len, order, orders, ref, results, squad, target, to;
    this.g.selectAll(".orders").remove();
    orders = this.g.append('g').attr('class', 'orders');
    ref = data.squads;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      squad = ref[i];
      order = squad.order != null ? squad.order.toLowerCase() : "";
      if (order === "none" || order === "") {
        continue;
      }
      if (squad.health <= 0) {
        continue;
      }
      target = _.find(data.squads, function(s) {
        return s.name === squad.target;
      });
      to = target != null ? target.members[0].location : squad.targetLocation;
      from = squad.members[0].location;
      results.push(orders.append("line").attr("class", (squad.type.toLowerCase()) + " " + order).attr("x1", from.x).attr("y1", from.y).attr("x2", to.x).attr("y2", to.y).attr("marker-end", "url(#arrowhead)"));
    }
    return results;
  };
  this.drawActors = function(data) {
    if (data == null) {
      return;
    }
    this.drawOrders(data);
    return this.drawPawns(data);
  };
  this.draw = function(data) {
    var linesfunc, rot, xmap, zoom;
    xmap = this;
    linesfunc = d3.svg.line().x(function(d) {
      return d.x;
    }).y(function(d) {
      return d.y;
    }).interpolate("linear-closed");
    if (this.zoom) {
      rot = 0;
      zoom = d3.behavior.zoom().on("zoom", function() {
        xmap.g.attr("transform", "translate( " + d3.event.translate + " ) scale( " + d3.event.scale + " )");
        return console.log(d3.event.translate, d3.event.scale, rot);
      });
      d3.select('#legends_model svg').call(zoom);
    }
    this.g.selectAll(".areas").remove();
    this.g.append('g').attr('class', 'areas').selectAll('.area').data(data.areas).enter().append("g").attr("class", "area").attr("transform", function(d) {
      return xmap.transform(d);
    }).attr("fill-opacity", function(d) {
      return xmap.opacity(d);
    }).style("stroke", function(d) {
      return xmap.stroke(d);
    }).append("path").attr("d", function(d) {
      return linesfunc(d.edges);
    }).attr("fill", function(d) {
      return xmap.colour(d);
    });
    if (this.text) {
      return areas.append("text").attr("transform", function(d) {
        return "translate(" + d.center.x + "," + d.center.y + ")";
      }).text(function(d) {
        return d.id;
      });
    }
  };
};

//# sourceMappingURL=data:application/json;base64,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dGVudCI6WyIjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuTWFwID0gKGNvbmZpZykgLT5cclxuXHJcbiAgQGcgICAgICAgICAgPSBudWxsXHJcbiAgQHpvb20gICAgICAgPSB0cnVlXHJcbiAgQHRleHQgICAgICAgPSBmYWxzZVxyXG5cclxuICBAdHJhbnNmb3JtICA9IChkKSAtPiBcInRyYW5zbGF0ZSgje2QuY2VudGVyLnh9LCN7ZC5jZW50ZXIueX0pXCJcclxuICBAY29sb3VyICAgICA9IChkKSAtPiBcIiMjeyBkLmNvbG91cl9iYXNlLnNsaWNlKCAwLCA2ICkgfVwiXHJcbiAgQG9wYWNpdHkgICAgPSAoZCkgLT4gMC4yXHJcbiAgQHN0cm9rZSAgICAgPSAoZCkgLT4gXCJibHVlXCJcclxuXHJcblxyXG4gIF8uZXh0ZW5kIHRoaXMsIGNvbmZpZ1xyXG5cclxuXHJcbiAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBAZHJhd1Bhd25zID0gKGRhdGEpIC0+XHJcblxyXG5cclxuICAgIGFjdG9yRGF0YSA9IFtdXHJcblxyXG4gICAgZm9yIHMgaW4gZGF0YS5zcXVhZHNcclxuICAgICAgZm9yIG0gaW4gcy5tZW1iZXJzXHJcbiAgICAgICAgbS5zcXVhZCA9IHNcclxuICAgICAgICBhY3RvckRhdGEucHVzaCBtXHJcblxyXG5cclxuICAgIEBnXHJcbiAgICAgIC5zZWxlY3RBbGwgXCIuYWN0b3JzXCJcclxuICAgICAgLnJlbW92ZSgpXHJcblxyXG4gICAgYWN0b3JzID0gQGdcclxuICAgICAgLmFwcGVuZCAnZydcclxuICAgICAgLmF0dHIgJ2NsYXNzJywgJ2FjdG9ycydcclxuXHJcbiAgICBhY3RvcnMgPSBhY3RvcnMuc2VsZWN0QWxsIFwiLmFjdG9yXCJcclxuICAgICAgLmRhdGEgYWN0b3JEYXRhXHJcbiAgICAgIC5lbnRlcigpXHJcbiAgICAgIC5hcHBlbmQgXCJnXCJcclxuICAgICAgICAuYXR0ciBcImNsYXNzXCIsIFwiYWN0b3JcIlxyXG4gICAgICAgIC5hdHRyIFwidHJhbnNmb3JtXCIsIChkKSAtPiBcInRyYW5zbGF0ZSggI3tkLmxvY2F0aW9uLnh9LCAje2QubG9jYXRpb24ueX0gKVwiXHJcblxyXG4gICAgYWN0b3JzXHJcbiAgICAgIC5hcHBlbmQgXCJjaXJjbGVcIlxyXG4gICAgICAgIC5hdHRyICAgXCJjbGFzc1wiLCAoZCkgLT5cclxuICAgICAgICAgIGlmIGQuc3F1YWQ/IGFuZCBkLnNxdWFkLnR5cGU/XHJcbiAgICAgICAgICAgIGQuc3F1YWQudHlwZS50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIFwiY3JlYXR1cmVcIlxyXG4gICAgICAgIC5hdHRyICAgXCJyXCIsICAgICAgXCI1MC4wXCJcclxuICAgICAgICAuc3R5bGUgIFwiZmlsbFwiLCAgIChkKSAtPlxyXG4gICAgICAgICAgaWYgZC5zcXVhZC5oZWFsdGggPD0gMCB0aGVuIFwiI0RERERERFwiIGVsc2UgXCJcIlxyXG4gICAgICAgIC5zdHlsZSAgXCJzdHJva2VcIiwgKGQpIC0+XHJcbiAgICAgICAgICBpZiBkLnNxdWFkLmhlYWx0aCA8PSAwIHRoZW4gXCIjQ0NDQ0NDXCIgZWxzZSBcIlwiXHJcblxyXG5cclxuICAjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIEBkcmF3T3JkZXJzID0gKGRhdGEpIC0+XHJcblxyXG4gICMgXCJvcmRlclwiOlwiU3BlY2lhbFwiLFwidGFyZ2V0XCI6XCJQcmluY2VDaGFybWluZ1wiLFwidGFyZ2V0TG9jYXRpb25cIjp7XCJ4XCI6OTM3LFwieVwiOjMxNTk3fX1cclxuXHJcbiAgICBAZ1xyXG4gICAgICAuc2VsZWN0QWxsIFwiLm9yZGVyc1wiXHJcbiAgICAgIC5yZW1vdmUoKVxyXG5cclxuICAgIG9yZGVycyA9IEBnXHJcbiAgICAgIC5hcHBlbmQgJ2cnXHJcbiAgICAgIC5hdHRyICdjbGFzcycsICdvcmRlcnMnXHJcblxyXG5cclxuICAgIGZvciBzcXVhZCBpbiBkYXRhLnNxdWFkc1xyXG5cclxuICAgICAgb3JkZXIgPSBpZiBzcXVhZC5vcmRlcj8gdGhlbiBzcXVhZC5vcmRlci50b0xvd2VyQ2FzZSgpIGVsc2UgXCJcIlxyXG5cclxuICAgICAgY29udGludWUgaWYgb3JkZXIgPT0gXCJub25lXCIgb3Igb3JkZXIgPT0gXCJcIlxyXG4gICAgICBjb250aW51ZSBpZiBzcXVhZC5oZWFsdGggPD0gMFxyXG5cclxuICAgICAgIyBnZXQgb3JkZXIgbG9jYXRpb25cclxuXHJcbiAgICAgIHRhcmdldCAgPSBfLmZpbmQgZGF0YS5zcXVhZHMsIChzKSAtPiBzLm5hbWUgPT0gc3F1YWQudGFyZ2V0XHJcbiAgICAgIHRvICAgICAgPSBpZiB0YXJnZXQ/IHRoZW4gdGFyZ2V0Lm1lbWJlcnNbMF0ubG9jYXRpb24gZWxzZSBzcXVhZC50YXJnZXRMb2NhdGlvblxyXG5cclxuICAgICMgICAjIGNyZWF0ZSBsaW5lXHJcblxyXG4gICAgICBmcm9tICA9IHNxdWFkLm1lbWJlcnNbMF0ubG9jYXRpb25cclxuXHJcbiAgICAgIG9yZGVycy5hcHBlbmQgXCJsaW5lXCJcclxuICAgICAgICAuYXR0ciBcImNsYXNzXCIsIFwiI3sgc3F1YWQudHlwZS50b0xvd2VyQ2FzZSgpIH0gI3sgb3JkZXIgfVwiXHJcbiAgICAgICAgLmF0dHIgXCJ4MVwiLCBmcm9tLnhcclxuICAgICAgICAuYXR0ciBcInkxXCIsIGZyb20ueVxyXG4gICAgICAgIC5hdHRyIFwieDJcIiwgdG8ueFxyXG4gICAgICAgIC5hdHRyIFwieTJcIiwgdG8ueVxyXG4gICAgICAgIC5hdHRyIFwibWFya2VyLWVuZFwiLCBcInVybCgjYXJyb3doZWFkKVwiXHJcblxyXG5cclxuXHJcbiAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBAZHJhd0FjdG9ycyA9IChkYXRhKSAtPlxyXG5cclxuICAgICMgcHJvY2VzcyBkYXRhXHJcblxyXG4gICAgcmV0dXJuIHVubGVzcyBkYXRhP1xyXG5cclxuICAgIEBkcmF3T3JkZXJzIGRhdGFcclxuICAgIEBkcmF3UGF3bnMgZGF0YVxyXG5cclxuXHJcbiAgIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBAZHJhdyA9IChkYXRhKSAtPlxyXG5cclxuICAgIHhtYXAgPSB0aGlzXHJcblxyXG4gICAgbGluZXNmdW5jID1cclxuICAgICAgZDMuc3ZnLmxpbmUoKVxyXG4gICAgICAgIC54IChkKSAtPiBkLnhcclxuICAgICAgICAueSAoZCkgLT4gZC55XHJcbiAgICAgICAgLmludGVycG9sYXRlIFwibGluZWFyLWNsb3NlZFwiXHJcblxyXG5cclxuICAgICMgaW5pdCB6b29tIGhhbmRsZXJcclxuXHJcbiAgICBpZiBAem9vbVxyXG5cclxuICAgICAgcm90ID0gMFxyXG5cclxuICAgICAgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKS5vbiBcInpvb21cIiwgLT5cclxuICAgICAgICB4bWFwLmcuYXR0ciBcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZSggI3tkMy5ldmVudC50cmFuc2xhdGV9ICkgc2NhbGUoICN7ZDMuZXZlbnQuc2NhbGV9IClcIlxyXG4gICAgICAgIGNvbnNvbGUubG9nIGQzLmV2ZW50LnRyYW5zbGF0ZSwgZDMuZXZlbnQuc2NhbGUsIHJvdFxyXG5cclxuICAgICAgZDNcclxuICAgICAgICAuc2VsZWN0ICcjbGVnZW5kc19tb2RlbCBzdmcnXHJcbiAgICAgICAgLmNhbGwgem9vbVxyXG5cclxuXHJcbiAgICAjIGRyYXcgYXJlYXNcclxuXHJcbiAgICBAZ1xyXG4gICAgICAuc2VsZWN0QWxsIFwiLmFyZWFzXCJcclxuICAgICAgLnJlbW92ZSgpXHJcblxyXG4gICAgQGcuYXBwZW5kICdnJ1xyXG5cclxuICAgICAgLmF0dHIgJ2NsYXNzJywgJ2FyZWFzJ1xyXG4gICAgICAuc2VsZWN0QWxsICcuYXJlYSdcclxuICAgICAgLmRhdGEgZGF0YS5hcmVhc1xyXG4gICAgICAuZW50ZXIoKVxyXG5cclxuICAgICAgLmFwcGVuZCBcImdcIlxyXG4gICAgICAgIC5hdHRyIFwiY2xhc3NcIiwgICAgICAgIFwiYXJlYVwiXHJcbiAgICAgICAgLmF0dHIgXCJ0cmFuc2Zvcm1cIiwgICAgKGQpIC0+IHhtYXAudHJhbnNmb3JtIGRcclxuICAgICAgICAuYXR0ciBcImZpbGwtb3BhY2l0eVwiLCAoZCkgLT4geG1hcC5vcGFjaXR5IGRcclxuICAgICAgICAuc3R5bGUgXCJzdHJva2VcIiwgICAgICAoZCkgLT4geG1hcC5zdHJva2UgZFxyXG5cclxuICAgICAgICAuYXBwZW5kIFwicGF0aFwiXHJcbiAgICAgICAgICAuYXR0ciBcImRcIiwgICAgICAgICAgKGQpIC0+IGxpbmVzZnVuYyBkLmVkZ2VzXHJcbiAgICAgICAgICAuYXR0ciBcImZpbGxcIiwgICAgICAgKGQpIC0+IHhtYXAuY29sb3VyIGRcclxuXHJcblxyXG4gICAgIyBhcHBlbmQgdGV4dFxyXG5cclxuICAgIGlmIEB0ZXh0XHJcbiAgICAgIGFyZWFzXHJcbiAgICAgICAgLmFwcGVuZCBcInRleHRcIlxyXG4gICAgICAgICAgLmF0dHIgXCJ0cmFuc2Zvcm1cIiwgKGQpIC0+IFwidHJhbnNsYXRlKCN7ZC5jZW50ZXIueH0sI3tkLmNlbnRlci55fSlcIiAjbWFwLnRyYW5zZm9ybSBkXHJcbiAgICAgICAgICAudGV4dCAoZCkgLT4gZC5pZFxyXG5cclxuICByZXR1cm5cclxuIl19